cures_frame_tilt_temp %>%
filter(Date >= "2021-01-01" & Date <= "2021-12-31")
cures_frame_tilt_temp %>%
filter(Date >= "2021-01-01" & Date <= "2021-12-31")
cures_frame_tilt_temp %>%
filter(Date >= "2021-01-01" & Date <= "2021-12-31") %>%
mutate(month = m(Date))
library(lubridate)
library(readxl  )
library(readxl)
cures_frame_tilt_temp %>%
filter(Date >= "2021-01-01" & Date <= "2021-12-31") %>%
mutate(month = m(Date))
cures_frame_tilt_temp %>%
filter(Date >= "2021-01-01" & Date <= "2021-12-31") %>%
mutate(month = month(Date))
cures_frame_tilt_temp %>%
filter(Date >= "2021-01-01" & Date <= "2021-12-31") %>%
mutate(month = month(Date), year = year(Date))
cures_frame_tilt_temp %>%
filter(Date >= "2021-01-01" & Date <= "2021-12-31") %>%
select(Date, `Temperature (C)`)
cures_frame_tilt_temp %>%
filter(Date >= "2021-01-01" & Date <= "2021-12-31") %>%
select(Date, `Temperature (C)`) %>%
arrange(Date)
cures_frame_tilt_temp %>%
filter(Date >= "2021-01-01" & Date <= "2021-12-31") %>%
select(Date, `Temperature (C)`) %>%
arrange(Date) %>%
mutate(month = month(Date), year = year(Date)) %>%
group_by(Month, Year) %>%
summarize(MM = mean(Temperature, na.rm = TRUE))
cures_frame_tilt_temp %>%
filter(Date >= "2021-01-01" & Date <= "2021-12-31") %>%
select(Date, `Temperature (C)`) %>%
arrange(Date) %>%
mutate(month = month(Date), year = year(Date))
cures_frame_tilt_temp %>%
filter(Date >= "2021-01-01" & Date <= "2021-12-31") %>%
select(Date, `Temperature (C)`) %>%
arrange(Date) %>%
mutate(month = month(Date), year = year(Date)) %>%
group_by(month, year) %>%
summarize(MM = mean(Temperature, na.rm = TRUE))
cures_frame_tilt_temp %>%
filter(Date >= "2021-01-01" & Date <= "2021-12-31") %>%
select(Date, `Temperature (C)`) %>%
arrange(Date) %>%
mutate(month = month(Date), year = year(Date)) %>%
group_by(month, year) %>%
summarize(MM = mean(`Temperature (C)`, na.rm = TRUE))
cures_frame_tilt_temp %>%
filter(Date >= "2021-01-01" & Date <= "2021-12-31") %>%
select(Date, `Temperature (C)`) %>%
arrange(Date) %>%
mutate(month = month(Date), year = year(Date)) %>%
group_by(month, year) %>%
summarize(MM = mean(`Temperature (C)`, na.rm = TRUE)) %>%
ungroup() %>%
group_by(month) %>%
summarize(Clima_M = mean(MM, na.rm = TRUE))
cures_frame_tilt_temp %>%
filter(Date >= "2021-01-01" & Date <= "2021-12-31") %>%
select(Date, `Temperature (C)`) %>%
arrange(Date) %>%
mutate(month = month(Date), year = year(Date)) %>%
group_by(month, year) %>%
summarize(MM = mean(`Temperature (C)`, na.rm = TRUE)) %>%
ungroup() %>%
group_by(month) %>%
summarize(Clima_M = mean(MM, na.rm = TRUE)) %>%
arrange(desc(MM))
cures_frame_tilt_temp %>%
filter(Date >= "2021-01-01" & Date <= "2021-12-31") %>%
select(Date, `Temperature (C)`) %>%
arrange(Date) %>%
mutate(month = month(Date), year = year(Date)) %>%
group_by(month, year) %>%
summarize(MM = mean(`Temperature (C)`, na.rm = TRUE)) %>%
ungroup() %>%
group_by(month) %>%
summarize(Clima_M = mean(MM, na.rm = TRUE)) %>%
arrange(desc(Clima_M))
cures_frame_tilt_temp %>%
filter(Date >= "2021-01-01" & Date <= "2021-12-31") %>%
select(Date, `Temperature (C)`) %>%
arrange(Date) %>%
mutate(month = month(Date), year = year(Date)) %>%
group_by(month, year) %>%
summarize(MM = mean(`Temperature (C)`, na.rm = TRUE)) %>%
ungroup()
cures_frame_tilt_temp %>%
filter(Date >= "2021-01-01" & Date <= "2021-12-31") %>%
select(Date, `Temperature (C)`) %>%
arrange(Date) %>%
mutate(month = month(Date), year = year(Date)) %>%
group_by(month, year) %>%
summarize(MM = mean(`Temperature (C)`, na.rm = TRUE)) %>%
arrange(desc(MM))
# trim off the first and last days because those include time points before the HOBO was in the water
KB_09112020<-read_csv("raw_data/archive/KBNursery_2020_09_11.csv", skip = 1)
KB_09112020 %>%
mutate(Datetime_EST=with_tz(mdy_hm(`Date Time, GMT-04:00`, tz = "Etc/GMT+4"), tzone = "Etc/GMT+4")) %>%
mutate(Datetime_EST=with_tz(Datetime_EST, tzone = "America/New_York")) %>%
dplyr::rename(Temperature = `Temp, °C (LGR S/N: 20597589, SEN S/N: 20597589)`) %>%
dplyr::rename(Light = `Intensity, lum/ft² (LGR S/N: 20597589, SEN S/N: 20597589)`) %>%
dplyr::select(Temperature, Light, Datetime_EST) -> KB_09112020
KB_09112020
View(KB_09112020)
KB_02102021 <- read_csv("raw_data/archive/KBNursery_2021_02_10.csv", skip = 1)
KB_02102021 %>%
mutate(Datetime_EST=with_tz(mdy_hms(`Date Time, GMT-05:00`, tz = "Etc/GMT+5"), tzone = "Etc/GMT+5")) %>%
mutate(Datetime_EST=with_tz(Datetime_EST, tzone = "America/New_York")) %>%
dplyr::rename(Temperature = `Temp, °C (LGR S/N: 20976501, SEN S/N: 20976501)`) %>%
dplyr::rename(Light = `Intensity, lum/ft² (LGR S/N: 20976501, SEN S/N: 20976501)`) %>%
dplyr::select(Temperature, Light, Datetime_EST) -> KB_02102021
View(KB_02102021)
KB_05282021 <- read_csv("raw_data/KBNursery_2021_05_28.csv", skip = 1)
KB_05282021 %>%
mutate(Datetime_EST=with_tz(mdy_hms(`Date Time, GMT-04:00`, tz = "Etc/GMT+4"), tzone = "Etc/GMT+4")) %>%
mutate(Datetime_EST=with_tz(Datetime_EST, tzone = "America/New_York")) %>%
dplyr::rename(Temperature = `Temp, °C (LGR S/N: 21085862, SEN S/N: 21085862)`) %>%
dplyr::select(Temperature, Datetime_EST) %>%
filter(Datetime_EST > "2021-05-29 01:00:00" & Datetime_EST < "2021-08-11 11:00:00") %>%
mutate(Light = NA) -> KB_05282021
View(KB_05282021)
KB_08112021 <- read_csv("raw_data/KBNursery_2021_08_11.csv", skip = 1)
KB_08112021 %>%
mutate(Datetime_EST=with_tz(mdy_hm(`Date Time, GMT-04:00`, tz = "Etc/GMT+4"), tzone = "Etc/GMT+4")) %>%
mutate(Datetime_EST=with_tz(Datetime_EST, tzone = "America/New_York")) %>%
dplyr::rename(Temperature = `Temp, °C (LGR S/N: 20831178, SEN S/N: 20831178)`) %>%
dplyr::rename(Light = `Intensity, lum/ft² (LGR S/N: 20831178, SEN S/N: 20831178)`) %>%
filter(Datetime_EST < "2021-12-07 17:00:00") %>%
dplyr::select(Temperature, Light, Datetime_EST) -> KB_08112021
KB_120821 <- read_csv("raw_data/KBNursery_2021_12_08.csv", skip = 1)
KB_120821%>%
mutate(Datetime_EST=with_tz(mdy_hm(`Date Time, GMT-05:00`, tz = "Etc/GMT+5"), tzone = "Etc/GMT+5")) %>%
mutate(Datetime_EST=with_tz(Datetime_EST, tzone = "America/New_York")) %>%
dplyr::rename(Temperature = `Temp, °C (LGR S/N: 21236769, SEN S/N: 21236769)`) %>%
dplyr::rename(Light = `Intensity, lum/ft² (LGR S/N: 21236769, SEN S/N: 21236769)`) %>%
filter(Datetime_EST > "2021-12-10 04:00:00" & Datetime_EST < "2021-12-31 00:00:00") %>%
dplyr::select(Temperature, Light, Datetime_EST) -> KB_120821
rbind(KB_09112020, KB_02102021, KB_05282021, KB_08112021, KB_120821) -> all_KB_data
all_KB_data$Temperature <- as.numeric(all_KB_data$Temperature)
all_KB_data %>%
tidyr::separate(Datetime_EST, c("Date", "Time"), sep = "\\ ", remove = FALSE) %>%
mutate(Date = as.Date(Date), Time = format(Datetime_EST, format = "%H:%M:%S")) -> all_KB_data
all_KB_data %>%
mutate(Time_period = hms(Time)) -> all_KB_data
ggplot(all_KB_data, aes(x=Datetime_EST, y=Temperature, color = site)) +
geom_point() +
theme_bw() +
scale_x_datetime(date_labels = "%b %Y",  # Customize the date format
date_breaks = "1 month") +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
ggplot(all_KB_data, aes(x=Datetime_EST, y=Temperature)) +
geom_point() +
theme_bw() +
scale_x_datetime(date_labels = "%b %Y",  # Customize the date format
date_breaks = "1 month") +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
all_KB_data %>%
filter(Datetime_EST > "2021-01-01" & Datetime_EST < "2021-02-28") %>%
ggplot(., aes(x=Datetime_EST, y=Temperature)) +
geom_point() +
theme_bw() +
scale_x_datetime(date_labels = "%b %Y",  # Customize the date format
date_breaks = "1 month") +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
KB_09112020 %>%
filter(Datetime_EST > "2021-01-02" & Datetime_EST < "2021-02-10")
KB_09112020 %>%
filter(Datetime_EST > "2021-01-02" & Datetime_EST < "2021-02-10") -> KB_09112020
rbind(KB_09112020, KB_02102021, KB_05282021, KB_08112021, KB_120821) -> all_KB_data
all_KB_data$Temperature <- as.numeric(all_KB_data$Temperature)
all_KB_data %>%
tidyr::separate(Datetime_EST, c("Date", "Time"), sep = "\\ ", remove = FALSE) %>%
mutate(Date = as.Date(Date), Time = format(Datetime_EST, format = "%H:%M:%S")) -> all_KB_data
all_KB_data %>%
mutate(Time_period = hms(Time)) -> all_KB_data
all_KB_data %>%
filter(Datetime_EST > "2021-01-01" & Datetime_EST < "2021-02-28") %>%
ggplot(., aes(x=Datetime_EST, y=Temperature)) +
geom_point() +
theme_bw() +
scale_x_datetime(date_labels = "%b %Y",  # Customize the date format
date_breaks = "1 month") +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
all_KB_data %>%
filter(Datetime_EST > "2021-01-01" & Datetime_EST < "2021-12-31") %>%
ggplot(., aes(x=Datetime_EST, y=Temperature)) +
geom_point() +
theme_bw() +
scale_x_datetime(date_labels = "%b %Y",  # Customize the date format
date_breaks = "1 month") +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
all_KB_data %>%
filter(Datetime_EST > "2021-02-10" & Datetime_EST < "2021-05-28") %>%
ggplot(., aes(x=Datetime_EST, y=Temperature)) +
geom_point() +
theme_bw() +
scale_x_datetime(date_labels = "%b %Y",  # Customize the date format
date_breaks = "1 month") +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
KB_02102021 %>%
arrange(desc(Datetime_EST))
KB_02102021 %>%
filter(Datetime_EST > "2021-02-09" & Datetime_EST < "2021-05-28") -> KB_02102021
# trim off the first and last days because those include time points before the HOBO was in the water
KB_09112020<-read_csv("raw_data/archive/KBNursery_2020_09_11.csv", skip = 1)
KB_09112020 %>%
mutate(Datetime_EST=with_tz(mdy_hm(`Date Time, GMT-04:00`, tz = "Etc/GMT+4"), tzone = "Etc/GMT+4")) %>%
mutate(Datetime_EST=with_tz(Datetime_EST, tzone = "America/New_York")) %>%
dplyr::rename(Temperature = `Temp, °C (LGR S/N: 20597589, SEN S/N: 20597589)`) %>%
dplyr::rename(Light = `Intensity, lum/ft² (LGR S/N: 20597589, SEN S/N: 20597589)`) %>%
dplyr::select(Temperature, Light, Datetime_EST) -> KB_09112020
KB_09112020 %>%
filter(Datetime_EST > "2021-01-02" & Datetime_EST < "2021-02-10") -> KB_09112020
KB_02102021 <- read_csv("raw_data/archive/KBNursery_2021_02_10.csv", skip = 1)
KB_02102021 %>%
mutate(Datetime_EST=with_tz(mdy_hms(`Date Time, GMT-05:00`, tz = "Etc/GMT+5"), tzone = "Etc/GMT+5")) %>%
mutate(Datetime_EST=with_tz(Datetime_EST, tzone = "America/New_York")) %>%
dplyr::rename(Temperature = `Temp, °C (LGR S/N: 20976501, SEN S/N: 20976501)`) %>%
dplyr::rename(Light = `Intensity, lum/ft² (LGR S/N: 20976501, SEN S/N: 20976501)`) %>%
dplyr::select(Temperature, Light, Datetime_EST) -> KB_02102021
KB_02102021 %>%
filter(Datetime_EST > "2021-02-09" & Datetime_EST < "2021-05-28") -> KB_02102021
KB_05282021 <- read_csv("raw_data/KBNursery_2021_05_28.csv", skip = 1)
KB_05282021 %>%
mutate(Datetime_EST=with_tz(mdy_hms(`Date Time, GMT-04:00`, tz = "Etc/GMT+4"), tzone = "Etc/GMT+4")) %>%
mutate(Datetime_EST=with_tz(Datetime_EST, tzone = "America/New_York")) %>%
dplyr::rename(Temperature = `Temp, °C (LGR S/N: 21085862, SEN S/N: 21085862)`) %>%
dplyr::select(Temperature, Datetime_EST) %>%
filter(Datetime_EST > "2021-05-29 01:00:00" & Datetime_EST < "2021-08-11 11:00:00") %>%
mutate(Light = NA) -> KB_05282021
KB_08112021 <- read_csv("raw_data/KBNursery_2021_08_11.csv", skip = 1)
KB_08112021 %>%
mutate(Datetime_EST=with_tz(mdy_hm(`Date Time, GMT-04:00`, tz = "Etc/GMT+4"), tzone = "Etc/GMT+4")) %>%
mutate(Datetime_EST=with_tz(Datetime_EST, tzone = "America/New_York")) %>%
dplyr::rename(Temperature = `Temp, °C (LGR S/N: 20831178, SEN S/N: 20831178)`) %>%
dplyr::rename(Light = `Intensity, lum/ft² (LGR S/N: 20831178, SEN S/N: 20831178)`) %>%
filter(Datetime_EST < "2021-12-07 17:00:00") %>%
dplyr::select(Temperature, Light, Datetime_EST) -> KB_08112021
KB_120821 <- read_csv("raw_data/KBNursery_2021_12_08.csv", skip = 1)
KB_120821%>%
mutate(Datetime_EST=with_tz(mdy_hm(`Date Time, GMT-05:00`, tz = "Etc/GMT+5"), tzone = "Etc/GMT+5")) %>%
mutate(Datetime_EST=with_tz(Datetime_EST, tzone = "America/New_York")) %>%
dplyr::rename(Temperature = `Temp, °C (LGR S/N: 21236769, SEN S/N: 21236769)`) %>%
dplyr::rename(Light = `Intensity, lum/ft² (LGR S/N: 21236769, SEN S/N: 21236769)`) %>%
filter(Datetime_EST > "2021-12-10 04:00:00" & Datetime_EST < "2021-12-31 00:00:00") %>%
dplyr::select(Temperature, Light, Datetime_EST) -> KB_120821
rbind(KB_09112020, KB_02102021, KB_05282021, KB_08112021, KB_120821) -> all_KB_data
all_KB_data$Temperature <- as.numeric(all_KB_data$Temperature)
all_KB_data %>%
tidyr::separate(Datetime_EST, c("Date", "Time"), sep = "\\ ", remove = FALSE) %>%
mutate(Date = as.Date(Date), Time = format(Datetime_EST, format = "%H:%M:%S")) -> all_KB_data
all_KB_data %>%
mutate(Time_period = hms(Time)) -> all_KB_data
all_KB_data %>%
filter(Datetime_EST > "2021-02-10" & Datetime_EST < "2021-05-28") %>%
ggplot(., aes(x=Datetime_EST, y=Temperature)) +
geom_point() +
theme_bw() +
scale_x_datetime(date_labels = "%b %Y",  # Customize the date format
date_breaks = "1 month") +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
all_KB_data %>%
ggplot(., aes(x=Datetime_EST, y=Temperature)) +
geom_point() +
theme_bw() +
scale_x_datetime(date_labels = "%b %Y",  # Customize the date format
date_breaks = "1 month") +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
all_KB_data
all_KB_data %>%
filter(Date >= "2021-01-01" & Date <= "2021-12-31") %>%
select(Date, Temperature) %>%
arrange(Date) %>%
mutate(month = month(Date), year = year(Date)) %>%
group_by(month, year) %>%
summarize(MM = mean(`Temperature (C)`, na.rm = TRUE)) %>%
arrange(desc(MM)) #30.52 for CCC
all_KB_data %>%
filter(Date >= "2021-01-01" & Date <= "2021-12-31") %>%
select(Date, Temperature) %>%
arrange(Date) %>%
mutate(month = month(Date), year = year(Date)) %>%
group_by(month, year) %>%
summarize(MM = mean(Temperature, na.rm = TRUE)) %>%
arrange(desc(MM)) #30.52 for CCC
library(tidyverse)
tidy_KB_CCC_data <- read_csv("results_csv/tidy_KB_CCC_data.csv")
tidy_KB_CCC_data %>%
filter(Date < "2021-11-01" & Date > "2021-06-23") %>%
ggplot(., aes(x=Date, y=Temperature, color = site)) +
geom_line() +
theme_bw() +
scale_color_manual(values = c("CCC" = "orange", "Nursery" = "darkblue")) +
scale_x_date(date_labels = "%b %Y",  # Customize the date format
date_breaks = "1 month") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
labs(x="Month Year", y = "Temperature")
#ggsave("temps_experimentalperiod.pdf")
tidy_KB_CCC_data %>%
filter(as.Date(Datetime_EST) < "2021-12-01" & as.Date(Datetime_EST) > "2021-06-01") %>%
ggplot(., aes(x=Datetime_EST, y=Temperature, color = site)) +
geom_line() +
facet_wrap(~month, scales = "free") +
scale_color_manual(values = c("CCC" = "orange", "Nursery" = "darkblue")) +
theme_bw()  +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
#ggsave("monthly_temps.pdf", width = 10, height = 7)
ggsave("monthly_temps.pdf", width = 10, height = 7)
tidy_KB_CCC_data %>%
filter(as.Date(Datetime_EST) < "2021-12-01") %>%
group_by(as.Date(Datetime_EST), site) %>%
summarise(daily_variability = (max(Temperature)-min(Temperature))) %>%
mutate(season = case_when(`as.Date(Datetime_EST)` <= "2021-05-25" ~ "Dry",
`as.Date(Datetime_EST)` >= "2021-05-26" & `as.Date(Datetime_EST)` <= "2021-10-15" ~ "Wet",
`as.Date(Datetime_EST)` >= "2021-10-16" ~ "Dry")) %>%
ggplot(., aes(x=site, y=daily_variability, fill = site)) +
geom_violin() +
theme_classic() +
scale_fill_manual(values = c("CCC" = "orange", "Nursery" = "darkblue")) +
facet_wrap(~season) +
stat_summary(fun.y=mean, geom="point", shape=18,
size=3, color="black")
tidy_KB_CCC_data %>%
filter(as.Date(Datetime_EST) < "2021-12-01") %>%
group_by(as.Date(Datetime_EST), site) %>%
summarise(daily_variability = (max(Temperature)-min(Temperature))) %>%
mutate(season = case_when(`as.Date(Datetime_EST)` <= "2021-05-25" ~ "Dry",
`as.Date(Datetime_EST)` >= "2021-05-26" & `as.Date(Datetime_EST)` <= "2021-10-15" ~ "Wet",
`as.Date(Datetime_EST)` >= "2021-10-16" ~ "Dry")) %>%
ggplot(., aes(x=site, y=daily_variability, fill = site)) +
geom_violin() +
theme_classic() +
scale_fill_manual(values = c("CCC" = "orange", "Nursery" = "darkblue")) +
facet_wrap(~season) +
stat_summary(fun.y=mean, geom="point", shape=18,
size=3, color="black")
ggsave("averagedailyvariabilitybyseason.pdf", width = 8, height = 6)
dunn.test(daily_variability$daily_variability, daily_variability$site_season, method = "BH") %>%
as.data.frame()
tidy_KB_CCC_data %>%
filter(as.Date(Datetime_EST) < "2021-12-01" & as.Date(Datetime_EST) > "2020-12-01") %>%
group_by(as.Date(Datetime_EST), site) %>%
summarise(daily_variability = (max(Temperature)-min(Temperature))) %>%
mutate(season = case_when(`as.Date(Datetime_EST)` <= "2021-05-25" ~ "Dry",
`as.Date(Datetime_EST)` >= "2021-05-26" & `as.Date(Datetime_EST)` <= "2021-10-15" ~ "Wet",
`as.Date(Datetime_EST)` >= "2021-10-16" ~ "Dry")) %>%
group_by(site, season) %>%
mutate(mean_variability = mean(daily_variability), sd_variability = sd(daily_variability)) -> daily_variability
library(rstatix)
# Ensure 'site' and 'season' are factors
daily_variability$site <- as.factor(daily_variability$site)
daily_variability$season <- as.factor(daily_variability$season)
treat_model <- lm(daily_variability ~ site*season, data = daily_variability)
treat_model_metrics <- augment(treat_model)
plot(treat_model)
# assess normality of residuals using Shapiro-Wilk test
shapiro_test(treat_model_metrics$.resid) # very significant
# assess homogeneity of variances using Levene's Test
levene_test(.resid ~ site*season, data = treat_model_metrics) #significant
#need to do non-parametric test
#kruskal-wallis test
daily_variability$site_season <- interaction(daily_variability$site, daily_variability$season)
kruskal.test(daily_variability ~ site_season, data = daily_variability) # significant
library(dunn.test)
# Perform Dunn's test with Bonferonni correction
dunn.test(daily_variability$daily_variability, daily_variability$site_season, method = "BH") %>%
as.data.frame()
MaxDHW_SST
library(raster)
library(parallel)
library(ncdf4)
library(tidyverse)
library(lubridate)
library(readxl)
#Climatology_MMM <- "raw_data/ct5km_climatology_v3.1.nc" #this only has mean monthly maximum data
tidy_KB_CCC_data <- read_csv("results_csv/tidy_KB_CCC_data.csv")
#for the DHW rollapplyr function it is critical that the dates are in ascending order and that the sites are separated
#first do nursery
tidy_KB_CCC_data %>%
filter(site == "Nursery") %>%
arrange(Datetime_EST) %>%
dplyr::group_by(Date) %>%
mutate(mean_daily_temp = mean(Temperature)) %>%
dplyr::select(Date, mean_daily_temp, site) %>%
distinct() %>%
mutate(HotSpot = mean_daily_temp - 29.53) %>%
mutate(HotSpot = ifelse(HotSpot >= 0, HotSpot, 0)) %>%
mutate(Stress = ifelse(HotSpot >= 1, HotSpot, 0)) %>%
mutate(Weeks_Stress = Stress/7) -> Long.data.DHW.nurserySST
Long.data.DHW.nurserySST$DHW<-zoo::rollapplyr(Long.data.DHW.nurserySST$Weeks_Stress,list(-(83:0)),sum,fill=NA)
ggplot(Long.data.DHW.nurserySST, aes(x=ymd(Date))) +
geom_hline(yintercept=8, linetype="dashed")+
geom_hline(yintercept=4, linetype="dashed")+
geom_line(aes(y = DHW)) #ok this looks better
# now do CCC
tidy_KB_CCC_data %>%
filter(site == "CCC") %>%
arrange(Datetime_EST) %>%
dplyr::group_by(Date) %>%
mutate(mean_daily_temp = mean(Temperature)) %>%
dplyr::select(Date, mean_daily_temp, site) %>%
distinct() %>%
mutate(HotSpot = mean_daily_temp - 29.53) %>%
mutate(HotSpot = ifelse(HotSpot >= 0, HotSpot, 0)) %>%
mutate(Stress = ifelse(HotSpot >= 1, HotSpot, 0)) %>%
mutate(Weeks_Stress = Stress/7)  -> Long.data.DHW.CCCSST
Long.data.DHW.CCCSST$DHW<-zoo::rollapplyr(Long.data.DHW.CCCSST$Weeks_Stress,list(-(83:0)),sum,fill=NA)
ggplot(Long.data.DHW.CCCSST, aes(x=ymd(Date))) +
geom_hline(yintercept=8, linetype="dashed")+
geom_hline(yintercept=4, linetype="dashed")+
geom_line(aes(y = DHW)) #ok this looks better
# Plot just DHW SST data
full_join(Long.data.DHW.nurserySST, Long.data.DHW.CCCSST) %>%
ggplot(., aes(x=Date, y = DHW, color = site)) +
geom_hline(yintercept=4, linetype="dashed")+
geom_line() +
ylab("DHW (C-week)  /  Temperature (C)") +
xlab("Date") +
theme_classic() +
scale_color_manual(values = c("CCC" = "orange", "Nursery" = "darkblue")) +
scale_x_date(limits=c(ymd("2021-08-24"), ymd("2021-12-01")),
date_labels = "%b %Y",  # Customize the date format
date_breaks = "1 month") +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
#ggsave("DHW_linegraph.pdf")
## Highest DHW per year
#this is only the span of january to december 2021
MaxDHW_SST<-full_join(Long.data.DHW.nurserySST, Long.data.DHW.CCCSST) %>%
filter(ymd(Date) >= "2021-01-01") %>%
group_by(site) %>%
summarize(max = max(DHW, na.rm=TRUE))
# CCC = 5 DHW
# Nursery = 4.17 DHW
MaxDHW_SST
full_join(Long.data.DHW.nurserySST, Long.data.DHW.CCCSST) %>%
filter(ymd(Date) >= "2021-01-01")
full_join(Long.data.DHW.nurserySST, Long.data.DHW.CCCSST) %>%
filter(ymd(Date) >= "2021-01-01")
full_join(Long.data.DHW.nurserySST, Long.data.DHW.CCCSST) %>%
filter(ymd(Date) >= "2021-01-01") %>%
filter(Temperature > 30.5)
full_join(Long.data.DHW.nurserySST, Long.data.DHW.CCCSST) %>%
filter(ymd(Date) >= "2021-01-01")
full_join(Long.data.DHW.nurserySST, Long.data.DHW.CCCSST) %>%
filter(ymd(Date) >= "2021-01-01") %>%
filter(mean_daily_temp > 30.5)
full_join(Long.data.DHW.nurserySST, Long.data.DHW.CCCSST) %>%
filter(ymd(Date) >= "2021-01-01") %>%
filter(mean_daily_temp > 30.5) %>%
group_by(site) %>%
summarise(count = n())
full_join(Long.data.DHW.nurserySST, Long.data.DHW.CCCSST) %>%
filter(ymd(Date) >= "2021-01-01") %>%
filter(mean_daily_temp > 31) %>%
group_by(site) %>%
summarise(count = n())
tidy_KB_CCC_data
tidy_KB_CCC_data %>%
groupby(site, day) %>%
summarise(max_temp = max(Temperature))
tidy_KB_CCC_data %>%
group_by(site, day) %>%
summarise(max_temp = max(Temperature))
tidy_KB_CCC_data %>%
group_by(site, Date) %>%
summarise(max_temp = max(Temperature))
tidy_KB_CCC_data %>%
group_by(site, Date) %>%
summarise(max_temp = max(Temperature)) %>%
tidy_KB_CCC_data %>%
group_by(site, Date) %>%
summarise(max_temp = max(Temperature))
tidy_KB_CCC_data %>%
group_by(site, Date) %>%
summarise(max_temp = max(Temperature)) %>%
filter(max_temp > 30.5)
tidy_KB_CCC_data %>%
group_by(site, Date) %>%
summarise(max_temp = max(Temperature)) %>%
filter(max_temp > 30.5) %>%
group_by(site) %>%
summarise(count = n())
tidy_KB_CCC_data %>%
group_by(site, Date) %>%
summarise(max_temp = max(Temperature)) %>%
filter(max_temp > 31) %>%
group_by(site) %>%
summarise(count = n())
tidy_KB_CCC_data %>%
group_by(site, Date) %>%
summarise(max_temp = max(Temperature)) %>%
filter(max_temp > 32) %>%
group_by(site) %>%
summarise(count = n())
tidy_KB_CCC_data %>%
group_by(site, Date) %>%
summarise(max_temp = max(Temperature)) %>%
filter(max_temp > 31) %>%
group_by(site) %>%
summarise(count = n())
tidy_KB_CCC_data %>%
group_by(site, Date) %>%
summarise(max_temp = max(Temperature)) %>%
filter(max_temp > 31.5) %>%
group_by(site) %>%
summarise(count = n())
