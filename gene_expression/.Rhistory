high = n_colors[2],
kegg.native = T # T: outputs a traditional KEGG pathway map, F: outputs a different map style
)
map_id <- "05215" #Prostate cancer
# run pathview on a specific path
pv_path <- pathview(
gene.data = CCCvsnursery_KEGG_DGEs,
pathway.id = map_id,
species = "ko",
out.suffix = "Prostate cancer",
limit = list(
gene = c(-1, 1), # upper and lower range of log2foldchange values
cpd = c(-4, 4)),
discrete = list(
gene = FALSE, # set this to true when working with discrete data
cpd = FALSE),
low = n_colors[1],
mid = n_colors[4],
high = n_colors[2],
kegg.native = T # T: outputs a traditional KEGG pathway map, F: outputs a different map style
)
# run pathview on a specific path
pv_path <- pathview(
gene.data = CCCvsnursery_KEGG_DGEs,
pathway.id = map_id,
species = "ko",
out.suffix = "Fluid shear stress and atherosclerosis",
limit = list(
gene = c(-1, 1), # upper and lower range of log2foldchange values
cpd = c(-4, 4)),
discrete = list(
gene = FALSE, # set this to true when working with discrete data
cpd = FALSE),
low = n_colors[1],
mid = n_colors[4],
high = n_colors[2],
kegg.native = T # T: outputs a traditional KEGG pathway map, F: outputs a different map style
)
map_id <- "05418" #Fluid shear stress and atherosclerosis
# run pathview on a specific path
pv_path <- pathview(
gene.data = CCCvsnursery_KEGG_DGEs,
pathway.id = map_id,
species = "ko",
out.suffix = "Fluid shear stress and atherosclerosis",
limit = list(
gene = c(-1, 1), # upper and lower range of log2foldchange values
cpd = c(-4, 4)),
discrete = list(
gene = FALSE, # set this to true when working with discrete data
cpd = FALSE),
low = n_colors[1],
mid = n_colors[4],
high = n_colors[2],
kegg.native = T # T: outputs a traditional KEGG pathway map, F: outputs a different map style
)
load("RData_files/Location_CCC_vs_nursery_fc_lfcshrink.RData")
darkmagenta_genes <- read_csv("WGCNA/darkmagenta_genelist.csv")
Location_CCC_vs_nursery.fc %>% right_join(kegg.list, by = "gene") %>%
right_join(., darkmagenta_genes, by = "gene") %>%  #narrow down to only the DGEs
select(lfc, KO) %>%
na.omit() %>% #246 genes
distinct(KO, .keep_all = TRUE) %>% #228 distinct KEGG terms
column_to_rownames(var = "KO") -> darkmagenta_KEGG
KEGG_enrich_darkmagenta <- enrichKEGG(
gene = rownames(darkmagenta_KEGG),
organism = "ko",
keyType = "kegg",
pvalueCutoff = 0.05,
pAdjustMethod = "fdr",
universe = kegg.list$KO
)
dotplot(KEGG_enrich_brown2) #1 kegg term: neuroactive ligand-receptor interaction
dotplot(KEGG_enrich_darkmagenta) #1 kegg term: neuroactive ligand-receptor interaction
length(unique(KEGG_enrich_darkmagenta@result$Description)) #245 unique KEGG terms
KEGG_enrich_darkmagenta@result$geneID
pathway_ids <- rownames(KEGG_enrich_darkmagenta@result)
# Retrieve information for each pathway
pathway_info <- lapply(pathway_ids, keggGet)
# Extract pathway names and categories
pathway_details <- sapply(pathway_info, function(x) {
pathway_name <- x[[1]]$NAME
pathway_category <- x[[1]]$CLASS
return(c(Name = pathway_name, Category = pathway_category))
})
# Display the pathway names and categories
print(pathway_details)
pathway_categories_df <- tibble(
Pathway_ID = names(pathway_details),
Details = pathway_details
)
pathway_categories_df <- pathway_categories_df %>%
mutate(Description = sapply(Details, function(x) x[1]),
Category = sapply(Details, function(x) x[2])) %>%
select(-Details)
KEGG_enrich_darkmagenta_categories <- left_join(KEGG_enrich_darkmagenta@result, pathway_categories_df, by = "Description")
length(unique(KEGG_enrich_darkmagenta_categories$Category)) #43 unique categories
KEGG_enrich_darkmagenta_categories %>%
filter(p.adjust<0.1) # map04080	Neuroactive ligand-receptor interaction
KEGG_enrich_darkmagenta_categories %>%
filter(p.adjust<0.1) # map04080	Neuroactive ligand-receptor interaction
# Define a color ramp from blue to red
blue_to_red <- colorRampPalette(c("blue", "red"))
# Generate n colors from this palette
n_colors <- blue_to_red(2)
map_id <- "04080" #Neuroactive ligand-receptor interaction
# run pathview on a specific path
pv_path <- pathview(
gene.data = darkmagenta_KEGG,
pathway.id = map_id,
species = "ko",
out.suffix = "Neuroactive ligand-receptor interaction",
limit = list(
gene = c(-1, 1), # upper and lower range of log2foldchange values
cpd = c(-4, 4)),
discrete = list(
gene = FALSE, # set this to true when working with discrete data
cpd = FALSE),
low = n_colors[1],
mid = n_colors[4],
high = n_colors[2],
kegg.native = T # T: outputs a traditional KEGG pathway map, F: outputs a different map style
)
#this doesn't look useful or interesting
darkmagenta_KEGG
gene_annot <- read.table(file="bioinformatics/Acervicornis_iso2geneName.tab", sep = "\t", quote="", fill=FALSE)
gene_annot %>%
rename(gene = V1, annot=V2) -> gene_annot
KEGG_enrich_darkmagenta_categories %>%
filter(ID == "map04080") %>%
mutate(keggids=strsplit(geneID,  "/")) %>%
unnest(keggids) %>%
rename(KO = keggids) %>%
inner_join(kegg.list, by = "KO") %>%
left_join(.,gene_annot, by = "gene") %>%
write_csv("KEGG_darkmagentamodule_withgenes.csv")
KEGG_enrich_darkmagenta_categories %>%
filter(ID == "map04080") %>%
mutate(keggids=strsplit(geneID,  "/")) %>%
unnest(keggids) %>%
rename(KO = keggids) %>%
inner_join(kegg.list, by = "KO") %>%
left_join(.,gene_annot, by = "gene")
load("RData_files/Location_CCC_vs_nursery_fc_lfcshrink.RData")
magenta3_genes <- read_csv("WGCNA/magenta3_genelist.csv") #735 genes
mediumpurple3_genes <- read_csv("WGCNA/mediumpurple3_genelist.csv") #735 genes
KEGG_enrich_mediumpurple3 <- enrichKEGG(
gene = rownames(mediumpurple3_KEGG),
organism = "ko",
keyType = "kegg",
pvalueCutoff = 0.05,
pAdjustMethod = "fdr",
universe = kegg.list$KO
)
Location_CCC_vs_nursery.fc %>% right_join(kegg.list, by = "gene") %>%
right_join(., mediumpurple3_genes, by = "gene") %>%  #narrow down to only the DGEs
select(lfc, KO) %>%
na.omit() %>% #290 genes
distinct(KO, .keep_all = TRUE) %>% #263 distinct KEGG terms
column_to_rownames(var = "KO") -> mediumpurple3_KEGG
KEGG_enrich_mediumpurple3 <- enrichKEGG(
gene = rownames(mediumpurple3_KEGG),
organism = "ko",
keyType = "kegg",
pvalueCutoff = 0.05,
pAdjustMethod = "fdr",
universe = kegg.list$KO
)
dotplot(KEGG_enrich_mediumpurple3) #1 kegg term: neuroactive ligand-receptor interaction
length(unique(KEGG_enrich_mediumpurple3@result$Description)) #245 unique KEGG terms
KEGG_enrich_mediumpurple3@result$geneID
pathway_ids <- rownames(KEGG_enrich_mediumpurple3@result)
# Retrieve information for each pathway
pathway_info <- lapply(pathway_ids, keggGet)
# Extract pathway names and categories
pathway_details <- sapply(pathway_info, function(x) {
pathway_name <- x[[1]]$NAME
pathway_category <- x[[1]]$CLASS
return(c(Name = pathway_name, Category = pathway_category))
})
# Display the pathway names and categories
print(pathway_details)
pathway_categories_df <- tibble(
Pathway_ID = names(pathway_details),
Details = pathway_details
)
pathway_categories_df <- pathway_categories_df %>%
mutate(Description = sapply(Details, function(x) x[1]),
Category = sapply(Details, function(x) x[2])) %>%
select(-Details)
KEGG_enrich_mediumpurple3_categories <- left_join(KEGG_enrich_mediumpurple3@result, pathway_categories_df, by = "Description")
length(unique(KEGG_enrich_mediumpurple3_categories$Category)) #43 unique categories
KEGG_enrich_mediumpurple3_categories %>%
filter(p.adjust<0.1) # map04080	Neuroactive ligand-receptor interaction
KEGG_enrich_mediumpurple3_categories %>%
filter(p.adjust<0.1) # map04080	Neuroactive ligand-receptor interaction
# Define a color ramp from blue to red
blue_to_red <- colorRampPalette(c("blue", "red"))
# Generate n colors from this palette
n_colors <- blue_to_red(2)
map_id <- "04080" #Neuroactive ligand-receptor interaction
# run pathview on a specific path
pv_path <- pathview(
gene.data = mediumpurple3_KEGG,
pathway.id = map_id,
species = "ko",
out.suffix = "Neuroactive ligand-receptor interaction",
limit = list(
gene = c(-1, 1), # upper and lower range of log2foldchange values
cpd = c(-4, 4)),
discrete = list(
gene = FALSE, # set this to true when working with discrete data
cpd = FALSE),
low = n_colors[1],
mid = n_colors[4],
high = n_colors[2],
kegg.native = T # T: outputs a traditional KEGG pathway map, F: outputs a different map style
)
KEGG_enrich_mediumpurple3_categories %>%
filter(ID == "map04080") %>%
mutate(keggids=strsplit(geneID,  "/")) %>%
unnest(keggids) %>%
rename(KO = keggids) %>%
inner_join(kegg.list, by = "KO") %>%
left_join(.,gene_annot, by = "gene") %>%
write_csv("KEGG_mediumpurple3_withgenes.csv")
knitr::opts_chunk$set(echo = TRUE)
library(KEGGREST)
library(tidyverse)
library(pathview)
library(clusterProfiler)
library(enrichplot)
library(cowplot)
kegg.list <- read.table("bioinformatics/Acervicornis_iso2kegg.tab")
colnames(kegg.list) <- c("TranscriptID","KO")
dim(kegg.list)
kegg.list %>%
mutate(gene = str_replace(TranscriptID, "Acervicornis", "Acropora_")) %>%
select(!TranscriptID) -> kegg.list
load("RData_files/Location_CCC_vs_nursery_fc_lfcshrink.RData")
CCC_vs_Nursery_DGEs <- read_csv("results/resLFCLocation_CCC_vs_nursery_annotDGEs_padj05.csv") #819 genes
Location_CCC_vs_nursery.fc %>% right_join(kegg.list, by = "gene") %>%
right_join(., CCC_vs_Nursery_DGEs, by = "gene") %>%  #narrow down to only the DGEs
select(lfc, KO) %>%
na.omit() %>% #412 genes
distinct(KO, .keep_all = TRUE) %>% #365 distinct KEGG terms
column_to_rownames(var = "KO") -> CCCvsnursery_KEGG_DGEs
#make csv file of DGEs with annot and KEGG term so this can be searched in the KEGG database (https://www.genome.jp/kegg/mapper/search.html)
#Location_CCC_vs_nursery.fc %>% right_join(kegg.list, by = "gene") %>%
# right_join(., CCC_vs_Nursery_DGEs, by = "gene") %>%
# write_csv("DGEs_annot_KEGGterms.csv")
gene_annot <- read.table(file="bioinformatics/Acervicornis_iso2geneName.tab", sep = "\t", quote="", fill=FALSE)
gene_annot %>%
rename(gene = V1, annot=V2) -> gene_annot
<
gene_annot <- read.table(file="bioinformatics/Acervicornis_iso2geneName.tab", sep = "\t", quote="", fill=FALSE)
gene_annot
View(CCC_vs_Nursery_DGEs)
View(Location_CCC_vs_nursery.fc)
CCC_vs_Nursery_DGEs`
CCC_vs_Nursery_DGEs
CCC_vs_Nursery_DGEs %>%
rename(gene_L2FC = log2FoldChange, padj_gene = padj)
CCC_vs_Nursery_DGEs %>%
rename(gene_L2FC = log2FoldChange, padj_gene = padj) %>%
select(gene, gene_L2FC, padj_gene) -> DGEs_withL2FC
KEGG_enrich_mediumpurple3_categories %>%
filter(ID == "map04080") %>%
mutate(keggids=strsplit(geneID,  "/")) %>%
unnest(keggids) %>%
rename(KO = keggids) %>%
inner_join(kegg.list, by = "KO") %>%
left_join(.,gene_annot, by = "gene") %>%
left_join(., DGEs_withL2FC, by ="gene")
KEGG_enrich_mediumpurple3_categories_withgenes <- read_csv("KEGG_mediumpurple3_withgenes.csv")
KEGG_enrich_mediumpurple3_categories_withgenes
KEGG_enrich_mediumpurple3_categories_withgenes %>%
left_join(., DGEs_withL2FC, by ="gene")
DGEs_withL2FC
KEGG_enrich_mediumpurple3_categories_withgenes
Location_CCC_vs_nursery.fc
KEGG_enrich_mediumpurple3_categories_withgenes %>%
left_join(., Location_CCC_vs_nursery.fc, by ="gene")
load("RData_files/Location_CCC_vs_nursery_fc_lfcshrink.RData")
mediumpurple3_genes <- read_csv("WGCNA/mediumpurple3_genelist.csv")
Location_CCC_vs_nursery.fc
Location_CCC_vs_nursery.fc %>% right_join(kegg.list, by = "gene")
Location_CCC_vs_nursery.fc %>% right_join(kegg.list, by = "gene") %>%
right_join(., mediumpurple3_genes, by = "gene")
mediumpurple3_genes
library(tidyverse)
library(DESeq2)
library(cowplot)
load("Rdata_files/initial_fullddsdesigncountsVsdcounts.RData")
load("Rdata_files/realModels_Acer.RData")
KEGG_genes <- read_csv("results/KEGG_CvN_results_withgenes.csv")
View(KEGG_genes)
KEGG_genes <- read_csv("KEGG/KEGG_CvN_results_withgenes.csv")
View(KEGG_genes)
dds <- estimateSizeFactors(dds)
normalized_counts <- counts(dds, normalized=TRUE)
resLFC <- lfcShrink(dds, coef="Location_CCC_vs_nursery", type="apeglm")
normalized_counts %>%
as.data.frame() %>%
rownames_to_column(var="gene") -> normalized_counts
design %>%
rownames_to_column(var="Sample_ID") -> design
KEGG_genes %>%
dplyr::select(ID, Description, Category, KO, gene, annot) %>%
left_join(., normalized_counts, by = "gene") %>%  #151 genes
pivot_longer(Acer_1089:Acer_2384, names_to="Sample_ID", values_to="norm_expression") %>%
full_join(., design, by = "Sample_ID") -> KEGG_genes_normcounts
KEGG_genes_normcounts
resLFC %>%
as.data.frame() %>%
rownames_to_column(var="gene") %>%
dplyr::select(gene, log2FoldChange) -> genes_l2fc
resLFC %>%
as.data.frame() %>%
rownames_to_column(var="gene")
KEGG_genes_normcounts
genes_l2fc
KEGG_genes_normcounts %>%
right_join(., genes_l2fc, by="gene") -> KEGG_genes_normcounts_l2fc
KEGG_genes_normcounts_l2fc
KEGG_genes_normcounts_l2fc %>%
filter(ID == "map05200") %>%
filter(norm_expression > 0) %>%
arrange(desc(log2FoldChange))
KEGG_genes_normcounts_l2fc %>%
filter(ID == "map05200") %>%
filter(norm_expression > 0) %>%
arrange(desc(log2FoldChange)) %>%
select(gene, annot, norm_expression, log2FoldChange)
KEGG_genes_normcounts_l2fc %>%
filter(ID == "map05200") %>%
filter(norm_expression > 0) %>%
arrange(desc(log2FoldChange)) %>%
select(gene, annot, norm_expression, log2FoldChange) %>%
filter(grepl("TNF|tumor necrosis factor", annot))
KEGG_genes_normcounts_l2fc %>%
filter(ID == "map05200") %>%
filter(norm_expression > 0) %>%
arrange(desc(log2FoldChange)) %>%
select(gene, annot, log2FoldChange) %>%
distinct() %>%
filter(grepl("TNF|tumor necrosis factor", annot))
KEGG_genes_normcounts_l2fc %>%
filter(ID == "map05200") %>%
filter(norm_expression > 0) %>%
arrange(desc(log2FoldChange)) %>%
select(gene, annot, log2FoldChange) %>%
distinct() %>%
filter(grepl("TNF|tumor necrosis factor|tumor", annot))
KEGG_genes_normcounts_l2fc %>%
filter(ID == "map05200") %>%
filter(norm_expression > 0) %>%
arrange(desc(log2FoldChange)) %>%
select(gene, annot, log2FoldChange) %>%
distinct() %>%
filter(grepl("activation of NF-kappaB-inducing kinase activity", annot))
KEGG_genes_normcounts_l2fc %>%
filter(ID == "map05215") %>%
filter(norm_expression > 0) %>%
arrange(desc(log2FoldChange)) %>%
select(gene, annot, log2FoldChange) %>%
distinct() %>%
filter(grepl("fibroblast", annot))
KEGG_genes_normcounts_l2fc %>%
filter(ID == "map05215") %>%
filter(norm_expression > 0) %>%
arrange(desc(log2FoldChange)) %>%
select(gene, annot, log2FoldChange) %>%
distinct() %>%
filter(grepl("heat", annot))
KEGG_genes_normcounts_l2fc %>%
filter(ID == "map05215") %>%
filter(norm_expression > 0) %>%
arrange(desc(log2FoldChange)) %>%
select(gene, annot, log2FoldChange) %>%
distinct() %>%
filter(grepl("heat | Heat", annot))
KEGG_genes_normcounts_l2fc %>%
filter(ID == "map05215") %>%
#filter(norm_expression > 0) %>%
arrange(desc(log2FoldChange)) %>%
select(gene, annot, log2FoldChange) %>%
distinct() %>%
filter(grepl("heat | Heat", annot))
KEGG_genes_normcounts_l2fc %>%
filter(ID == "map05215") %>%
filter(norm_expression > 0) %>%
arrange(desc(log2FoldChange)) %>%
select(gene, annot, log2FoldChange) %>%
distinct()
KEGG_genes_normcounts_l2fc %>%
filter(ID == "map05215") %>%
filter(norm_expression > 0) %>%
arrange(desc(log2FoldChange)) %>%
select(gene, annot, log2FoldChange) %>%
distinct() %>%
filter(grepl("heat|Heat", annot))
KEGG_genes_normcounts_l2fc %>%
filter(ID == "map05200") %>%
filter(norm_expression > 0) %>%
arrange(desc(log2FoldChange)) %>%
select(gene, annot, log2FoldChange) %>%
distinct() %>%
filter(grepl("TNF|tumor necrosis factor|Tumor", annot))
KEGG_genes_normcounts_l2fc %>%
filter(ID == "map05418") %>%
filter(norm_expression > 0) %>%
arrange(desc(log2FoldChange)) %>%
select(gene, annot, log2FoldChange) %>%
distinct()
KEGG_genes_normcounts_l2fc %>%
filter(ID == "map05418") %>%
filter(norm_expression > 0) %>%
arrange(desc(log2FoldChange)) %>%
select(gene, annot, log2FoldChange) %>%
distinct() %>%
filter(grepl("heat|Heat", annot))
KEGG_genes_normcounts_l2fc %>%
filter(ID == "map05418") %>%
filter(norm_expression > 0) %>%
arrange(desc(log2FoldChange))
KEGG_genes_normcounts_l2fc %>%
filter(ID == "map05418") %>%
filter(norm_expression > 0) %>%
arrange(desc(log2FoldChange)) %>%
select(gene, annot, log2FoldChange) %>%
distinct() %>%
filter(grepl("heat|Heat", annot))
KEGG_genes_normcounts_l2fc %>%
filter(ID == "map05418") %>%
filter(norm_expression > 0) %>%
arrange(desc(log2FoldChange)) %>%
select(gene, annot, log2FoldChange) %>%
distinct()
KEGG_genes_normcounts_l2fc %>%
filter(ID == "map05418") %>%
filter(norm_expression > 0) %>%
arrange(desc(log2FoldChange)) %>%
select(gene, annot, log2FoldChange) %>%
distinct() %>%
filter(grepl("unfolded", annot))
KEGG_genes_normcounts_l2fc %>%
filter(ID == "map05418") %>%
filter(norm_expression > 0) %>%
arrange(desc(log2FoldChange))
KEGG_genes_normcounts_l2fc %>%
filter(ID == "map05418") %>%
filter(norm_expression > 0) %>%
arrange(desc(log2FoldChange)) %>%
select(gene, annot, log2FoldChange) %>%
distinct() %>%
filter(grepl("unfolded", annot))
KEGG_genes_normcounts_l2fc %>%
filter(ID == "map05418") %>%
filter(norm_expression > 0) %>%
arrange(desc(log2FoldChange)) %>%
select(gene, annot, log2FoldChange) %>%
distinct()
KEGG_genes_normcounts_l2fc %>%
filter(ID == "map05418") %>%
filter(norm_expression > 0) %>%
arrange(desc(log2FoldChange)) %>%
select(gene, annot, log2FoldChange) %>%
distinct() %>%
filter(grepl("EF", annot))
KEGG_WGCNA_darkmagenta_genes <- read_csv("KEGG/KEGG_darkmagentamodule_withgenes.csv")
KEGG_WGCNA_mediumpurple3_genes <- read_csv("KEGG/KEGG_mediumpurple3_withgenes.csv")
KEGG_WGCNA_darkmagenta_genes %>%
dplyr::select(ID, Description, Category, KO, gene, annot) %>%
left_join(., normalized_counts, by = "gene") %>%  #151 genes
pivot_longer(Acer_1089:Acer_2384, names_to="Sample_ID", values_to="norm_expression") %>%
full_join(., design, by = "Sample_ID") -> KEGG_darkmagenta_genes_normcounts
KEGG_darkmagenta_genes_normcounts %>%
right_join(., genes_l2fc, by="gene") -> KEGG_darkmagneta_genes_normcounts_l2fc
KEGG_darkmagneta_genes_normcounts_l2fc %>%
filter(ID == "map04080") %>%
filter(norm_expression > 0) %>%
arrange(desc(log2FoldChange)) %>%
select(gene, annot, log2FoldChange) %>%
distinct()
KEGG_darkmagneta_genes_normcounts_l2fc %>%
filter(ID == "map04080") %>%
filter(norm_expression > 0) %>%
arrange(desc(log2FoldChange)) %>%
select(gene, annot, log2FoldChange) %>%
distinct() %>%
filter(grepl("G-protein", annot))
KEGG_WGCNA_mediumpurple3_genes %>%
dplyr::select(ID, Description, Category, KO, gene, annot) %>%
left_join(., normalized_counts, by = "gene") %>%  #151 genes
pivot_longer(Acer_1089:Acer_2384, names_to="Sample_ID", values_to="norm_expression") %>%
full_join(., design, by = "Sample_ID") -> KEGG_mediumpurple3_genes_normcounts
KEGG_mediumpurple3_genes_normcounts %>%
right_join(., genes_l2fc, by="gene") -> KEGG_mediumpurple3_genes_normcounts_l2fc
KEGG_mediumpurple3_genes_normcounts_l2fc %>%
filter(ID == "map04080") %>%
filter(norm_expression > 0) %>%
arrange(desc(log2FoldChange)) %>%
select(gene, annot, log2FoldChange) %>%
distinct()
KEGG_mediumpurple3_genes_normcounts_l2fc %>%
filter(ID == "map04080") %>%
filter(norm_expression > 0) %>%
arrange(desc(log2FoldChange)) %>%
select(gene, annot, log2FoldChange) %>%
distinct() %>%
filter(grepl("G-protein", annot))
