design$Location <- factor(design$Location, levels = c("nursery","CCC")) #make the contrast so nursery is the baseline
str(design)
#check that they match each other
colnames(countData_sym)
rownames(design)
dds_sym = DESeqDataSetFromMatrix(countData=countData_sym, colData=design, design=~ Genotype + Location)
# for large datasets, rlog may take too much time, especially for an unfiltered dataframe
# vsd is much faster and still works for outlier detection
Vsd_sym=varianceStabilizingTransformation(dds_sym)
# if there were outliers:
outs=c(6,8) #these numbers were taken from the index.html report from arrayQualityMetrics Figure 2 "Outlier detection"
countData=countData_sym[,-outs]
#counts4wgcna=counts4wgcna[,-outs]
Vsd=Vsd_sym[,-outs]
counts4wgcna=counts4wgcna[,-outs]
design=design[-outs,]
str(counts4wgcna) #12 samples now
# remaking model with outliers removed from dataset
dds = DESeqDataSetFromMatrix(countData=countData, colData=design, design=~ Genotype + Location)
vsd=assay(Vsd)
colnames(vsd)
# takes the sample IDs and factor levels from the design to create new column names for the dataframe
snames=paste(colnames(countData),design[,2], design[,3],sep="_")
snames #i.e.
# renames the column names
colnames(vsd)=snames
str(design)
# more reduced stabilized dataset for WGCNA
wg = DESeqDataSetFromMatrix(countData=counts4wgcna, colData=design, design=~ Genotype + Location)
vsd.wg=assay(varianceStabilizingTransformation(wg), blind=FALSE) #blind=TRUE is the default, and it is a fully unsupervised transformation. However, the creator of DESeq2,
dds=DESeq(dds, parallel=TRUE)
SF.data <- estimateSizeFactors(dds)
print(sizeFactors(SF.data)) # everything is less than 4, so I can use vst
read.table(file = "1_bioinformatics/Symbiodinium_iso2geneName.tab",
sep = "\t",
quote="", fill=FALSE) %>%
dplyr::rename(gene = V1,
annot = V2) -> iso2geneName
resultsNames(dds)
Location_CCC_vs_nursery= results(dds,contrast=c("Location","CCC","nursery"))
summary(Location_CCC_vs_nursery, alpha = 0.05)
plotMA(Location_CCC_vs_nursery, ylim=c(-20,20))
degs_Location_CCC_vs_nursery_lfcshrink=row.names(resLFC)[resLFC$padj<0.05 & !(is.na(resLFC$padj))]
resLFC <- lfcShrink(dds, coef="Location_CCC_vs_nursery", type="apeglm")
plotMA(resLFC, ylim=c(-20,20))
#create data frames for DGEs
degs_Location_CCC_vs_nursery_lfcshrink=row.names(resLFC)[resLFC$padj<0.05 & !(is.na(resLFC$padj))]
length(degs_Location_CCC_vs_nursery_lfcshrink) #307
degs_Location_CCC_vs_nursery=row.names(Location_CCC_vs_nursery)[Location_CCC_vs_nursery$padj<0.05 & !(is.na(Location_CCC_vs_nursery$padj))]
length(degs_Location_CCC_vs_nursery) #307
Location_CCC_vs_nursery %>%
as.data.frame() %>%
rownames_to_column(var = "gene") %>%
drop_na(padj) %>%
filter(padj<0.05) %>%
full_join(., iso2geneName, by = "gene") %>%
drop_na(baseMean) %>%
select(gene, annot, baseMean:padj) %>%
write_csv("Location_CCC_vs_nursery_annotDGEs_symbiodinium_padj05.csv")
resLFC %>%
as.data.frame() %>%
rownames_to_column(var = "gene") %>%
drop_na(padj) %>%
filter(padj<0.05) %>%
full_join(., iso2geneName, by = "gene") %>%
drop_na(baseMean) %>%
select(gene, annot, baseMean:padj) %>%
write_csv("resLFCLocation_CCC_vs_nursery_annotDGEs_Symbiodinium_padj05.csv")
Location_CCC_vs_nursery
#
Location_CCC_vs_nursery %>%
as.data.frame() %>%
rownames_to_column(var="gene") %>%
mutate(lpv = -log(padj, base = 10)) %>%
mutate(lpv = if_else(stat < 0, lpv * -1, lpv)) %>%
filter(abs(lpv) >= 1.3) %>%
left_join(read.table(file = "1_bioinformatics/Symbiodinium_iso2geneName.tab",
sep = "\t",
quote="", fill=FALSE) %>%
mutate(gene = V1,
annot = V2) %>%
dplyr::select(-V1, -V2), by = c("gene" = "gene")) %>% str() #830 genes
#
Location_CCC_vs_nursery %>%
as.data.frame() %>%
rownames_to_column(var="gene") %>%
mutate(lpv = -log(padj, base = 10)) %>%
mutate(lpv = if_else(stat < 0, lpv * -1, lpv)) %>%
filter(abs(lpv) >= 1.3) %>%
left_join(read.table(file = "1_bioinformatics/Symbiodinium_iso2geneName.tab",
sep = "\t",
quote="", fill=FALSE) %>%
mutate(gene = V1,
annot = V2) %>%
dplyr::select(-V1, -V2), by = c("gene" = "gene")) %>%  #307 genes
write_csv("Sym_Location_CCC_vs_nursery_annotatedDGEs_lpv.csv")
library(pheatmap)
# similarity among samples
pheatmap(cor(vsd))
dev.off()
dev.off()
# similarity among samples
pheatmap(cor(vsd))
# Principal coordinates analysis
library(vegan)
# library(rgl)
library(ape)
conditions=design
colnames(vsd)
rownames(conditions)
# creating a PCoA eigenvalue matrix
dds.pcoa=pcoa(dist(t(vsd),method="manhattan")/1000)
scores=dds.pcoa$vectors
# copy this table for % variation explained by each axis (Relative_eig column)
dds.pcoa$values
# how many good PC's do we have? Compared to random ("broken stick") model
# plotting PCoA eigenvalues
#pdf(file="PCoA_Manhattan.pdf", width=6, height=6)
plot(dds.pcoa$values$Relative_eig)
points(dds.pcoa$values$Broken_stick,col="red",pch=3)
plot(scores[,1], scores[,2],col=c("orange","darkblue")[as.numeric(as.factor(conditions$Location))],pch=c(15,17,25)[as.numeric((as.factor(conditions$Genotype)))], xlab="Coordinate 1", ylab="Coordinate 2", main="Location")
ordispider(scores, conditions$Location, label=F, col=c("orange","darkblue"))
legend("topright", legend=c("CCC", "Nursery"), fill = c("orange","darkblue"), bty="n")
legend("topleft", legend=c("Cheetos_B", "MiamiBeach_C", "SunnyIsles_E"), pch=c(15,17,25), bty="n")
plot(scores[,1], scores[,2],col=c("orange","lightblue", "pink")[as.numeric(as.factor(conditions$Genotype))],pch=c(15,17,25)[as.numeric((as.factor(conditions$Location)))], xlab="Coordinate 1", ylab="Coordinate 2", main="Genotype")
ordispider(scores, conditions$Genotype, label=F, col=c("orange","lightblue", "pink"))
legend("topleft", legend=c("Cheetos_B", "MiamiBeach_C", "SunnyIsles_E"), fill = c("orange","lightblue", "pink"), bty="n")
legend("topright", legend=c("CCC", "Nursery"), pch=c(15,17,25), bty="n")
dev.off()
dev.off()
plot(scores[,1], scores[,2],col=c("orange","darkblue")[as.numeric(as.factor(conditions$Location))],pch=c(15,17,25)[as.numeric((as.factor(conditions$Genotype)))], xlab="Coordinate 1", ylab="Coordinate 2", main="Location")
ordispider(scores, conditions$Location, label=F, col=c("orange","darkblue"))
legend("topright", legend=c("CCC", "Nursery"), fill = c("orange","darkblue"), bty="n")
legend("topleft", legend=c("Cheetos_B", "MiamiBeach_C", "SunnyIsles_E"), pch=c(15,17,25), bty="n")
plot(scores[,1], scores[,2],col=c("orange","lightblue", "pink")[as.numeric(as.factor(conditions$Genotype))],pch=c(15,17,25)[as.numeric((as.factor(conditions$Location)))], xlab="Coordinate 1", ylab="Coordinate 2", main="Genotype")
ordispider(scores, conditions$Genotype, label=F, col=c("orange","lightblue", "pink"))
legend("topleft", legend=c("Cheetos_B", "MiamiBeach_C", "SunnyIsles_E"), fill = c("orange","lightblue", "pink"), bty="n")
legend("topright", legend=c("CCC", "Nursery"), pch=c(15,17,25), bty="n")
plot(scores[,1], scores[,2],col=c("orange","darkblue")[as.numeric(as.factor(conditions$Location))], xlab="Coordinate 1", ylab="Coordinate 2", main="Location")
ordispider(scores, conditions$Location, label=F, col=c("orange","darkblue"))
legend("topright", legend=c("CCC", "Nursery"), fill = c("orange","darkblue"), bty="n")
# plotting PCoA by location
plot(scores[,1], scores[,2],col=c("orange","darkblue")[as.numeric(as.factor(conditions$Location))], xlab="Coordinate 1: 41.3%", ylab="Coordinate 2:9.9%", main="Location")
plot(scores[,1], scores[,2],col=c("orange","darkblue")[as.numeric(as.factor(conditions$Location))], xlab="Coordinate 1: 41.3%", ylab="Coordinate 2:9.9%", main="Location")
ordispider(scores, conditions$Location, label=F, col=c("orange","darkblue"))
legend("topright", legend=c("CCC", "Nursery"), fill = c("orange","darkblue"), bty="n")
plot(scores[,1], scores[,2],col=c("orange","darkblue")[as.numeric(as.factor(conditions$Location))], xlab="Coordinate 1: 41.3%", ylab="Coordinate 2: 9.9%", main="Location")
ordispider(scores, conditions$Location, label=F, col=c("orange","darkblue"))
legend("topright", legend=c("CCC", "Nursery"), fill = c("orange","darkblue"), bty="n")
# formal analysis of variance in distance matricies:
ad=adonis2(t(vsd)~Genotype + Location,data=design,method="manhattan",permutations=1e6)
ad # not significant
summary(ad)
# formal analysis of variance in distance matricies:
ad=adonis2(t(vsd)~Genotype + Location,data=design,method="manhattan",permutations=1e6)
ad # not significant
library(EnhancedVolcano)
install.packages("EnhancedVolcano")
BiocManager::install("EnhancedVolcano")
library(EnhancedVolcano)
View(Location_CCC_vs_nursery)
sym_resLFC_Location_CCC_vs_nursery_annotated <- read_csv("resLFCLocation_CCC_vs_nursery_annotDGEs_Symbiodinium_padj05.csv")
sym_resLFC_Location_CCC_vs_nursery_annotated
keyvals <- ifelse(
resLFC_Location_CCC_vs_nursery_annotated$log2FoldChange < -1 & resLFC_Location_CCC_vs_nursery_annotated$padj < 0.05, 'darkblue',
ifelse(resLFC_Location_CCC_vs_nursery_annotated$log2FoldChange > 1 & resLFC_Location_CCC_vs_nursery_annotated$padj < 0.05, 'orange',
'grey'))
resLFC_Location_CCC_vs_nursery_annotated <- read_csv("resLFCLocation_CCC_vs_nursery_annotDGEs_Symbiodinium_padj05.csv")
keyvals <- ifelse(
resLFC_Location_CCC_vs_nursery_annotated$log2FoldChange < -1 & resLFC_Location_CCC_vs_nursery_annotated$padj < 0.05, 'darkblue',
ifelse(resLFC_Location_CCC_vs_nursery_annotated$log2FoldChange > 1 & resLFC_Location_CCC_vs_nursery_annotated$padj < 0.05, 'orange',
'grey'))
keyvals[is.na(keyvals)] <- 'grey'
names(keyvals)[keyvals == 'orange'] <- 'upregulated in CCC (Lf2C>1,padj<0.05)'
names(keyvals)[keyvals == 'grey'] <- 'L2FC=0 and padj > 0.05'
names(keyvals)[keyvals == 'darkblue'] <- 'upregulated in Nursery (Lf2C<-1,padj<0.05)'
EnhancedVolcano(resLFC_Location_CCC_vs_nursery_annotated,
lab = NA,
title = "CCC vs. Nursery",
x = 'log2FoldChange',
y = 'padj',
ylab = bquote(~-Log[10]~ 'FDR P-adjusted'),
legendPosition = 'right',
pCutoff = 10e-2,
FCcutoff = 1,
legendIconSize = 5.0,
labSize = 6.0,
colCustom = keyvals,
colAlpha = 0.5)
resLFC_Location_CCC_vs_nursery_annotated <- read_csv("Location_CCC_vs_nursery_annotDGEs_symbiodinium_padj05.csv")
EnhancedVolcano(resLFC_Location_CCC_vs_nursery_annotated,
lab = NA,
title = "CCC vs. Nursery",
x = 'log2FoldChange',
y = 'padj',
ylab = bquote(~-Log[10]~ 'FDR P-adjusted'),
legendPosition = 'right',
pCutoff = 10e-2,
FCcutoff = 1,
legendIconSize = 5.0,
labSize = 6.0,
colCustom = keyvals,
colAlpha = 0.5)
resLFC_Location_CCC_vs_nursery_annotated <- read_csv("resLFCLocation_CCC_vs_nursery_annotDGEs_Symbiodinium_padj05.csv")
plotMA(resLFC, ylim=c(-20,20))
degs_Location_CCC_vs_nursery_lfcshrink
Location_CCC_vs_nursery %>%
as.data.frame() %>%
rownames_to_column(var = "gene") %>%
drop_na(padj) %>%
filter(padj<0.05) %>%
full_join(., iso2geneName, by = "gene") %>%
drop_na(baseMean) %>%
select(gene, annot, baseMean:padj)
resultsNames(dds)
summary(Location_CCC_vs_nursery, alpha = 0.05)
plotMA(Location_CCC_vs_nursery, ylim=c(-20,20))
plotMA(resLFC, ylim=c(-20,20))
resLFC %>%
as.data.frame() %>%
rownames_to_column(var = "gene") %>%
drop_na(padj) %>%
filter(padj<0.05) %>%
full_join(., iso2geneName, by = "gene") %>%
drop_na(baseMean) %>%
select(gene, annot, baseMean:padj)
resultsNames(dds)
EnhancedVolcano(resLFC_Location_CCC_vs_nursery_annotated,
lab = NA,
title = "CCC vs. Nursery",
x = 'log2FoldChange',
y = 'padj',
ylab = bquote(~-Log[10]~ 'FDR P-adjusted'),
legendPosition = 'right',
pCutoff = 10e-2,
FCcutoff = 1,
legendIconSize = 5.0,
labSize = 6.0,
colCustom = keyvals,
colAlpha = 0.5)
pdf(file="volcanoplot_colorcoded.pdf", width = 12, height = 6)
EnhancedVolcano(resLFC_Location_CCC_vs_nursery_annotated,
lab = NA,
title = "CCC vs. Nursery",
x = 'log2FoldChange',
y = 'padj',
ylab = bquote(~-Log[10]~ 'FDR P-adjusted'),
legendPosition = 'right',
pCutoff = 10e-2,
FCcutoff = 1,
legendIconSize = 5.0,
labSize = 6.0,
colCustom = keyvals,
colAlpha = 0.5)
resLFC_Location_CCC_vs_nursery_annotated <- read_csv("resLFCLocation_CCC_vs_nursery_annotDGEs_Symbiodinium_padj05.csv")
keyvals <- ifelse(
resLFC_Location_CCC_vs_nursery_annotated$log2FoldChange < -1 & resLFC_Location_CCC_vs_nursery_annotated$padj < 0.05, 'darkblue',
ifelse(resLFC_Location_CCC_vs_nursery_annotated$log2FoldChange > 1 & resLFC_Location_CCC_vs_nursery_annotated$padj < 0.05, 'orange',
'grey'))
keyvals[is.na(keyvals)] <- 'grey'
names(keyvals)[keyvals == 'orange'] <- 'upregulated in CCC (Lf2C>1,padj<0.05)'
names(keyvals)[keyvals == 'grey'] <- 'L2FC=0 and padj > 0.05'
names(keyvals)[keyvals == 'darkblue'] <- 'upregulated in Nursery (Lf2C<-1,padj<0.05)'
pdf(file="volcanoplot_colorcoded.pdf", width = 12, height = 6)
EnhancedVolcano(resLFC_Location_CCC_vs_nursery_annotated,
lab = NA,
title = "CCC vs. Nursery",
x = 'log2FoldChange',
y = 'padj',
ylab = bquote(~-Log[10]~ 'FDR P-adjusted'),
legendPosition = 'right',
pCutoff = 10e-2,
FCcutoff = 1,
legendIconSize = 5.0,
labSize = 6.0,
colCustom = keyvals,
colAlpha = 0.5)
Location_CCC_vs_nursery %>%
as.data.frame() %>%
rownames_to_column(var = "gene") %>%
drop_na(padj) %>%
filter(padj<0.05)
degs_Location_CCC_vs_nursery
summary(ad)
ad
as.data.frame(ad) %>% write_csv("permanova_results_symbiont.csv")
resLFC_Location_CCC_vs_nursery_annotated
resLFC_Location_CCC_vs_nursery_annotated %>%
filter(log2FoldChange >=1)
resLFC_Location_CCC_vs_nursery_annotated %>%
filter(log2FoldChange >=0.4)
resLFC_Location_CCC_vs_nursery_annotated %>%
filter(log2FoldChange >=1)
resLFC_Location_CCC_vs_nursery_annotated %>%
filter(log2FoldChange <=1)
resLFC_Location_CCC_vs_nursery_annotated %>%
filter(log2FoldChange <=1)
resLFC_Location_CCC_vs_nursery_annotated %>%
filter(log2FoldChange <=-1)
resLFC_Location_CCC_vs_nursery_annotated <- read_csv("Location_CCC_vs_nursery_annotDGEs_symbiodinium_padj05.csv")
resLFC_Location_CCC_vs_nursery_annotated
resLFC_Location_CCC_vs_nursery_annotated %>%
filter(log2FoldChange <=-1)
resLFC_Location_CCC_vs_nursery_annotated %>%
filter(log2FoldChange >=1)
keyvals <- ifelse(
resLFC_Location_CCC_vs_nursery_annotated$log2FoldChange < -1 & resLFC_Location_CCC_vs_nursery_annotated$padj < 0.05, 'darkblue',
ifelse(resLFC_Location_CCC_vs_nursery_annotated$log2FoldChange > 1 & resLFC_Location_CCC_vs_nursery_annotated$padj < 0.05, 'orange',
'grey'))
keyvals[is.na(keyvals)] <- 'grey'
names(keyvals)[keyvals == 'orange'] <- 'upregulated in CCC (Lf2C>1,padj<0.05)'
names(keyvals)[keyvals == 'grey'] <- 'L2FC=0 and padj > 0.05'
names(keyvals)[keyvals == 'darkblue'] <- 'upregulated in Nursery (Lf2C<-1,padj<0.05)'
EnhancedVolcano(resLFC_Location_CCC_vs_nursery_annotated,
lab = NA,
title = "CCC vs. Nursery",
x = 'log2FoldChange',
y = 'padj',
ylab = bquote(~-Log[10]~ 'FDR P-adjusted'),
legendPosition = 'right',
pCutoff = 10e-2,
FCcutoff = 1,
legendIconSize = 5.0,
labSize = 6.0,
colCustom = keyvals,
colAlpha = 0.5)
resLFC_Location_CCC_vs_nursery_annotated <- read_csv("Symbiont_DESeq2_results/Location_CCC_vs_nursery_LFC_annotated.csv")")
EnhancedVolcano(resLFC_Location_CCC_vs_nursery_annotated,
lab = NA,
title = "CCC vs. Nursery",
resLFC_Location_CCC_vs_nursery_annotated <- read_csv("Symbiont_DESeq2_results/Location_CCC_vs_nursery_LFC_annotated.csv")
resLFC_Location_CCC_vs_nursery_annotated <- read_csv("Sym_Location_CCC_vs_nursery_annotatedDGEs_lpv.csv")
resLFC_Location_CCC_vs_nursery_annotated %>%
filter(log2FoldChange >=1)
EnhancedVolcano(resLFC_Location_CCC_vs_nursery_annotated,
lab = NA,
title = "CCC vs. Nursery",
x = 'log2FoldChange',
y = 'padj',
ylab = bquote(~-Log[10]~ 'FDR P-adjusted'),
legendPosition = 'right',
pCutoff = 10e-2,
FCcutoff = 1,
legendIconSize = 5.0,
labSize = 6.0,
colCustom = keyvals,
colAlpha = 0.5)
ad # not significant
library(DESeq2)
library(arrayQualityMetrics)
library(tidyverse)
#read in counts
counts = read.delim("results/counts.txt")
#select only Acropora genes, remove Symbiodinium
Sym_counts <- counts %>% filter(!grepl("^Acropora_[0-9]+$", X))
column_to_rownames(Sym_counts, var ="X") -> Sym_counts
Sym_counts %>%
rename_with(~sub("^X(.+)_trimmed$", "Acer_\\1", .)) %>%
select(!X.1) -> Sym_counts
# how many genes we have total?
nrow(Sym_counts) #35, 066
ncol(Sym_counts) #20 samples
# Based on alignment rates and number of reads (and the one "staghybrid" sample), I will be removing the following samples from downstream analysis:
#Acer_1087, Acer_1088, Acer_1096, Acer_2264, Acer_2383
Sym_counts %>%
select(!c("Acer_1087", "Acer_1088", "Acer_1096", "Acer_2264", "Acer_2383")) -> Sym_counts
nrow(Sym_counts) #35, 066
ncol(Sym_counts) #15 samples
# filtering out low-count genes
keep_sym <- rowSums(Sym_counts) >= 10 # you don't want to do too much pre-filtering because DESeq2 needs low-count genes for dispersion estimates
countData_sym <- Sym_counts[keep_sym,]
nrow(countData_sym) #31,202
ncol(countData_sym) #15
# for WCGNA: removing all genes with counts of <10 in more than 90 % of samples
counts4wgcna = Sym_counts[apply(Sym_counts,1,function(x) sum(x<10))<ncol(Sym_counts)*0.9,]
nrow(counts4wgcna) #24296
ncol(counts4wgcna) #15
#write.csv(counts4wgcna, file="Sym_counts4wgcna.csv")
# importing a design .csv file
design = readxl::read_xlsx("sample_metadata.xlsx")
design %>%
filter(!Sample_ID %in% c("1087", "1088", "1096", "2264", "2383")) -> design
design %>%
mutate(Sample_ID = paste("Acer_", Sample_ID, sep = "")) -> design
column_to_rownames(design, var="Sample_ID") -> design
design$Genotype <- as.factor(design$Genotype)
design$Genotype <- factor(gsub("-", "_", design$Genotype)) #DESeq2 does not like hyphens in factor names
design$Genotype <- factor(gsub("'", "", design$Genotype)) #DESeq2 does not like hyphens in factor names
design$Genotype <- factor(gsub(" ", "", design$Genotype)) #DESeq2 does not like hyphens in factor names
design$Location <- as.factor(design$Location)
str(design) #default is alphabetical order, so CCC is the "baseline"
design$Location <- factor(design$Location, levels = c("nursery","CCC")) #make the contrast so nursery is the baseline
str(design)
dds_sym = DESeqDataSetFromMatrix(countData=countData_sym, colData=design, design=~ Genotype + Location)
# for large datasets, rlog may take too much time, especially for an unfiltered dataframe
# vsd is much faster and still works for outlier detection
Vsd_sym=varianceStabilizingTransformation(dds_sym)
outs=c(6,8) #these numbers were taken from the index.html report from arrayQualityMetrics Figure 2 "Outlier detection"
countData=countData_sym[,-outs]
counts4wgcna=counts4wgcna[,-outs]
Vsd=Vsd_sym[,-outs]
design=design[-outs,]
# remaking model with outliers removed from dataset
dds = DESeqDataSetFromMatrix(countData=countData, colData=design, design=~ Genotype + Location)
dds=DESeq(dds, parallel=TRUE)
read.table(file = "1_bioinformatics/Symbiodinium_iso2geneName.tab",
sep = "\t",
quote="", fill=FALSE) %>%
dplyr::rename(gene = V1,
annot = V2) -> iso2geneName
resultsNames(dds)
# Location_CCC_vs_Nursery (we want "nursery" to be the baseline or control, and CCC to be the comparative variable or "treatment" group)
Location_CCC_vs_nursery= results(dds,contrast=c("Location","CCC","nursery"))
resLFC <- lfcShrink(dds, coef="Location_CCC_vs_nursery", type="apeglm")
# first re_run 1_Sym_deseq2.R because you didn't save any of the Rdata files
resLFC_Location_CCC_vs_nursery_annotated <- as.data.frame(resLFC) %>%
rownames_to_column(var="gene") %>%
left_join(read.table(file = "1_bioinformatics/Symbiodinium_iso2geneName.tab",
sep = "\t",
quote="", fill=FALSE) %>%
mutate(gene = V1,
annot = V2) %>%
dplyr::select(-V1, -V2), by = c("gene" = "gene"))
str(resLFC_Location_CCC_vs_nursery_annotated) #21814 x 7```
keyvals <- ifelse(
resLFC_Location_CCC_vs_nursery_annotated$log2FoldChange < -1 & resLFC_Location_CCC_vs_nursery_annotated$padj < 0.05, 'darkblue',
ifelse(resLFC_Location_CCC_vs_nursery_annotated$log2FoldChange > 1 & resLFC_Location_CCC_vs_nursery_annotated$padj < 0.05, 'orange',
'grey'))
keyvals[is.na(keyvals)] <- 'grey'
names(keyvals)[keyvals == 'orange'] <- 'upregulated in CCC (Lf2C>1,padj<0.05)'
names(keyvals)[keyvals == 'grey'] <- 'L2FC=0 and padj > 0.05'
names(keyvals)[keyvals == 'darkblue'] <- 'upregulated in Nursery (Lf2C<-1,padj<0.05)'
EnhancedVolcano(resLFC_Location_CCC_vs_nursery_annotated,
lab = NA,
title = "CCC vs. Nursery",
x = 'log2FoldChange',
y = 'padj',
ylab = bquote(~-Log[10]~ 'FDR P-adjusted'),
legendPosition = 'right',
pCutoff = 10e-2,
FCcutoff = 1,
legendIconSize = 5.0,
labSize = 6.0,
colCustom = keyvals,
colAlpha = 0.5)
library(EnhancedVolcano)
EnhancedVolcano(resLFC_Location_CCC_vs_nursery_annotated,
lab = NA,
title = "CCC vs. Nursery",
x = 'log2FoldChange',
y = 'padj',
ylab = bquote(~-Log[10]~ 'FDR P-adjusted'),
legendPosition = 'right',
pCutoff = 10e-2,
FCcutoff = 1,
legendIconSize = 5.0,
labSize = 6.0,
colCustom = keyvals,
colAlpha = 0.5)
EnhancedVolcano(resLFC_Location_CCC_vs_nursery_annotated,
lab = NA,
title = "CCC vs. Nursery",
x = 'log2FoldChange',
y = 'padj',
ylab = bquote(~-Log[10]~ 'FDR P-adjusted'),
legendPosition = 'right',
pCutoff = 10e-3,
FCcutoff = 1,
legendIconSize = 5.0,
labSize = 6.0,
colCustom = keyvals,
colAlpha = 0.5)
pdf(file="volcanoplot_colorcoded.pdf", width = 12, height = 6)
EnhancedVolcano(resLFC_Location_CCC_vs_nursery_annotated,
lab = NA,
title = "CCC vs. Nursery",
x = 'log2FoldChange',
y = 'padj',
ylab = bquote(~-Log[10]~ 'FDR P-adjusted'),
legendPosition = 'right',
pCutoff = 10e-3,
FCcutoff = 1,
legendIconSize = 5.0,
labSize = 6.0,
colCustom = keyvals,
colAlpha = 0.5)
resLFC_Location_CCC_vs_nursery_annotated %>%
filter(padj < 0.05 & log2FoldChange > 1)
resLFC_Location_CCC_vs_nursery_annotated %>%
filter(padj < 0.05 & log2FoldChange <= -1)
load("Rdata_files/pvals.RData")
resLFC_Location_CCC_vs_nursery_annotated <- as.data.frame(resLFC) %>%
rownames_to_column(var="gene") %>%
left_join(read.table(file = "bioinformatics/Acervicornis_iso2geneName.tab",
sep = "\t",
quote="", fill=FALSE) %>%
mutate(gene = V1,
annot = V2) %>%
dplyr::select(-V1, -V2), by = c("gene" = "gene"))
resLFC_Location_CCC_vs_nursery_annotated <- as.data.frame(resLFC) %>%
rownames_to_column(var="gene") %>%
left_join(read.table(file = "1_bioinformatics/Acervicornis_iso2geneName.tab",
sep = "\t",
quote="", fill=FALSE) %>%
mutate(gene = V1,
annot = V2) %>%
dplyr::select(-V1, -V2), by = c("gene" = "gene"))
str(resLFC_Location_CCC_vs_nursery_annotated) #21814 x 7
resLFC_Location_CCC_vs_nursery_annotated %>%
filter(padj < 0.05 & log2FoldChange <= -1)
resLFC_Location_CCC_vs_nursery_annotated %>%
filter(padj < 0.05 & log2FoldChange >= 1)
